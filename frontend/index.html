<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GrabVidi</title>
  <link rel="icon" href="images/Err_Deformed.webp" type="image/webp">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;1,9..144,400&family=Figtree:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0c0b0f;
      --bg-soft: #121118;
      --surface: #16151c;
      --border: #2a2832;
      --text: #e8e6ed;
      --muted: #6b6779;
      --accent: #c9a227;
      --accent-hover: #ddb83a;
      --accent-glow: rgba(201, 162, 39, 0.25);
      --error: #e07c6e;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Figtree", system-ui, sans-serif;
      background: var(--bg);
      background-image: radial-gradient(ellipse 120% 80% at 50% -20%, var(--bg-soft), transparent 60%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1.75rem;
    }
    main {
      width: 100%;
      max-width: 28rem;
    }
    h1 {
      font-family: "Fraunces", serif;
      font-size: 1.625rem;
      font-weight: 600;
      margin: 0 0 0.35rem;
      letter-spacing: 0.01em;
      color: var(--text);
    }
    .sub {
      font-size: 0.875rem;
      color: var(--muted);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }
    .input-wrap {
      display: flex;
      gap: 0.625rem;
      margin-bottom: 0.875rem;
    }
    input[type="url"] {
      flex: 1;
      padding: 0.7rem 1rem;
      font-size: 0.9375rem;
      font-family: inherit;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input[type="url"]::placeholder {
      color: var(--muted);
    }
    input[type="url"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    button {
      padding: 0.7rem 1.2rem;
      font-size: 0.9375rem;
      font-weight: 500;
      font-family: inherit;
      background: var(--accent);
      color: #0c0b0f;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      white-space: nowrap;
    }
    button:hover:not(:disabled) {
      background: var(--accent-hover);
    }
    button:active:not(:disabled) {
      transform: scale(0.98);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .message {
      font-size: 0.875rem;
      padding: 0.7rem 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      display: none;
    }
    .message.visible {
      display: block;
    }
    .message.error {
      background: rgba(224, 124, 110, 0.12);
      color: var(--error);
      border: 1px solid rgba(224, 124, 110, 0.28);
    }
    .message.loading {
      color: var(--muted);
      border: 1px solid var(--border);
    }
    .disclaimer {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2rem;
      max-width: 28rem;
      line-height: 1.55;
    }
    .supported {
      font-size: 0.8125rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }
    .mascot {
      width: 5rem;
      height: auto;
      margin-bottom: 1.25rem;
      display: block;
    }
  </style>
</head>
<body>
  <main>
    <img src="images/Err_Deformed.webp" alt="" class="mascot" width="80" height="80" />
    <h1>GrabVidi Social Video Downloader - Grab a video from social media</h1>
    <p class="sub">Paste a link to a video from Twitter, Instagram, TikTok, or Facebook.</p>
    <div class="input-wrap">
      <input
        type="url"
        id="url"
        placeholder="https://twitter.com/... or facebook.com/..."
        autocomplete="off"
      />
      <button type="button" id="btn">Download</button>
    </div>
    <p class="supported">Supported: Twitter/X, Instagram, TikTok, Facebook</p>
    <div id="message" class="message" role="alert"></div>
    <p class="disclaimer">
      For personal use only. Downloading may violate platform terms of service or copyright. Use at your own risk. This is not affiliated with any of the platforms mentioned. Vibecoded with Cursor AI for the homies
    </p>
  </main>
  <script>
    const urlInput = document.getElementById("url");
    const btn = document.getElementById("btn");
    const messageEl = document.getElementById("message");

    const API_BASE = "";

    function showMessage(text, type) {
      messageEl.textContent = text;
      messageEl.className = "message visible " + (type || "");
    }

    function hideMessage() {
      messageEl.className = "message";
    }

    async function handleDownload() {
      const url = urlInput.value.trim();
      if (!url) {
        showMessage("Please paste a video link.", "error");
        return;
      }

      btn.disabled = true;
      showMessage("Getting videoâ€¦", "loading");

      try {
        const res = await fetch(API_BASE + "/api/download", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url }),
        });

        const contentType = res.headers.get("Content-Type") || "";

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          const detail = data.detail || res.statusText;
          showMessage(detail, "error");
          if (res.status === 429) urlInput.focus();
          return;
        }

        if (contentType.includes("application/json")) {
          const data = await res.json();
          if (data.downloadUrl) {
            window.location.href = data.downloadUrl;
            showMessage("Download started.", "loading");
            setTimeout(hideMessage, 2500);
          } else {
            showMessage("No download URL returned.", "error");
          }
          return;
        }

        const blob = await res.blob();
        const disposition = res.headers.get("Content-Disposition");
        let filename = "video.mp4";
        if (disposition) {
          const match = disposition.match(/filename="?([^";\n]+)"?/);
          if (match) filename = match[1].trim();
        }
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
        showMessage("Download started.", "loading");
        setTimeout(hideMessage, 2500);
      } catch (err) {
        showMessage(err.message || "Network error.", "error");
      } finally {
        btn.disabled = false;
      }
    }

    btn.addEventListener("click", handleDownload);
    urlInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !btn.disabled) handleDownload();
    });
  </script>
</body>
</html>
